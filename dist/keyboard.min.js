angular.module("keyboard",[]),angular.module("keyboard").constant("undefined"),angular.module("keyboard").factory("KbContainerController",["undefined","$log",function(e,t){"use strict";function i(t){this.identifier="[kb-container]",this.ngModel=e,this.selected=[],this.multiple=!1,this.active=e,this._element=t[0]}return i.$inject=["$element"],angular.extend(i.prototype,{initialize:function(e){angular.extend(this,e),this.ngModel.$render=function(){this.multiple?(this.selected=this.ngModel.$viewValue,angular.isArray(this.selected)===!1&&(angular.isDefined(this.selected)&&t.error(this.identifier,"ng-model(multiple) must be an array, got:",this.selected),this.selected=[])):this.selected[0]=this.ngModel.$viewValue;for(var e in this.selected){var i=this._locate(this.selected[e]);if(i){this.active=i;break}}}.bind(this)},select:function(e){this.multiple?this.isSelected(e)===!1&&(this.selected.push(e),this.ngModel.$setViewValue(this.selected)):(this.selected[0]=e,this.ngModel.$setViewValue(e))},deselect:function(e){var t=this.selected.indexOf(e);-1!==t&&this.selected.splice(t,1)},toggle:function(e){this.isSelected(e)?this.deselect(e):this.select(e)},isSelected:function(e){return-1!==this.selected.indexOf(e)},previous:function(){var e=this._getSiblingItems(this.active).previous;return e?(this.active=e,!0):!1},next:function(){var e=this._getSiblingItems(this.active).next;return e?(this.active=e,!0):!1},activate:function(){return t.$error(this.identifier,"activate() is not implemented"),!1},invoke:function(){return t.$error(this.identifier,"invoke() is not implemented"),!1},_locate:function(e){for(var t=this._element.querySelectorAll("[kb-item]"),i=0;i<t.length;i++){var n=angular.element(t.item(i)).controller("kbItem");if(n.model===e)return n}},_getSiblingItems:function(e){for(var t=e.element[0],i=this._element.querySelectorAll("[kb-item]"),n=0;n<i.length;n++){var o=i.item(n);if(o===t){var l={};return 0!==n&&(l.previous=angular.element(i.item(n-1)).controller("kbItem")),n<i.length-1&&(l.next=angular.element(i.item(n+1)).controller("kbItem")),l}}return{}},_first:function(){var e=this._element.querySelector("[kb-item]");return e?e.controller("kbItem"):void 0}}),i}]),angular.module("keyboard").factory("KbItemController",["kbScroll","undefined",function(e,t){"use strict";return function(e){this.model=t,this.element=e}}]),angular.module("keyboard").directive("kbItem",["KbItemController","$animate","$log",function(e,t,i){"use strict";return{controller:e,require:["kbItem","?^kbList","?^kbSelect"],link:function(e,n,o,l){function r(e,t,i){return"left"===e&&i.left<t.left?t.left-i.left:"up"===e&&i.top<t.top?t.top-i.top:"right"===e&&i.left>t.left?i.left-t.left:"down"===e&&i.top>t.top?i.top-t.top:0}for(var a=l[0],c=l[1],s=1;s<l.length;s++)l[s]&&(c=l[s]);if(!c)return void i.error("Controller 'kbList' or 'kbSelect', required by directive 'kbItem', can't be found!");var u=o.kbSelectedClass||"kb-selected",d=o.kbActiveClass||"kb-active";a.model=e.$eval(o.kbItem),e.$watch(o.kbItem,function(e){a.model=e}),"undefined"==typeof c.active?c.active=a:c.isSelected(a.model)&&c.isSelected(c.active.model)===!1&&(c.active=a),e.$watch(function(){return c.isSelected(a.model)},function(e){e?t.addClass(n,u):t.removeClass(n,u)}),e.$watch(function(){return c.active===a},function(e){e?(n.attr("tabindex",0),t.addClass(n,d)):(t.removeClass(n,d),n.is("a")||n.is("button")?n.attr("tabindex",0):n.removeAttr("tabindex"))});var f={37:"left",38:"up",39:"right",40:"down"};n.on("keydown",function(t){var i=!1;if(t.which>=37&&t.which<=40){var o=c._getSiblingItems(a),l=n[0].getBoundingClientRect();o.previous&&r(f[t.which],l,o.previous.element[0].getBoundingClientRect())&&(c.activate(o.previous),i=!0),o.next&&r(f[t.which],l,o.next.element[0].getBoundingClientRect())&&(c.activate(o.next),i=!0)}else(32===t.which||13===t.which)&&(i=c.invoke(a));i&&(t.preventDefault(),e.$apply())}),n.on("click",function(){c.activate(a),c.invoke(a),e.$apply()}),e.$on("$destroy",function(){c.active=c._first()})}}}]),angular.module("keyboard").directive("kbList",["KbContainerController","kbScroll",function(e,t){"use strict";return{controller:e,require:["kbList","ngModel"],link:function(e,i,n,o){var l=o[0];l.initialize({identifier:"[kb-list]",ngModel:o[1],activate:function(e){this.active=e,this.select(e.model),t.focus(e.element[0])},invoke:function(){return!1}})}}}]),angular.module("keyboard").directive("kbSelect",["KbContainerController","kbScroll",function(e,t){"use strict";return{controller:e,require:["kbSelect","ngModel"],link:function(e,i,n,o){var l=o[0];l.initialize({identifier:"[kb-select]",ngModel:o[1],multiple:angular.isDefined(n.multiple),activate:function(e){this.active=e,t.focus(e.element[0])},invoke:function(e){return this.toggle(e.model),!0}})}}}]),angular.module("keyboard").service("kbScroll",["$window",function(e){var t="BODY";navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(t="HTML");var i=this;this.change=function(e,t,i,n){if(n&&angular.element.prototype.animate){var o=angular.element(e),l={};return l[t]=i,o.animate(l,n),function(){o.stop(!0,!0)}}return e[t]=i,angular.noop},this.getScrollParent=function(e){for(var i=e.parentElement;i.nodeName!==t;){var n=getComputedStyle(i),o=n.overflow+n.overflowX+n.overflowY;if(o.match(/scroll|hidden/))break;i=i.parentElement}return i},this.to=function(n,o,l){var r=angular.noop,a=i.getScrollParent(n),c=n.getBoundingClientRect(),s={top:Math.ceil(c.top),right:Math.ceil(c.right),bottom:Math.ceil(c.bottom),left:Math.ceil(c.left)};if(a.nodeName===t)var u={top:0,right:e.innerWidth,bottom:e.innerHeight,left:0};else var d=a.getBoundingClientRect(),u={top:Math.ceil(d.top),right:Math.ceil(d.right),bottom:Math.ceil(d.bottom),left:Math.ceil(d.left)};var f=s.top-u.top,h=u.right-s.right,m=u.bottom-s.bottom,g=s.left-u.left;if(f+o.top<0?(r=i.change(a,"scrollTop",a.scrollTop+f+o.top,l),m+=f,f=0):m+o.bottom<0&&(r=i.change(a,"scrollTop",a.scrollTop-m+o.bottom,l),f+=m,m=0),g+o.left<0?(r=i.change(a,"scrollLeft",a.scrollLeft+g+o.left,l),h+=g,g=0):h+o.right<0&&(r=i.change(a,"scrollLeft",a.scrollLeft-h+o.right,l),g+=h,h=0),a.nodeName===t)return r;var v=i.to(a,{top:f,right:f,bottom:m,left:g},l);return function(){r(),v()}};var n=angular.noop;this.focus=function(e){n();var t=this.getScrollParent(e),i={top:t.scrollTop,left:t.scrollLeft};e.hasAttribute("tabindex")||e.setAttribute("tabindex",0),e.focus(),(t.scrollTop!==i.top||t.scrollLeft!==i.left)&&(t.scrollTop=i.top,t.scrollLeft=i.left,n=this.to(e,{top:0,right:0,bottom:0,left:0},200))}}]);
//# sourceMappingURL=keyboard.min.js.map