angular.module("keyboard",[]),angular.module("keyboard").factory("KbListController",["undefined",function(e){"use strict";function t(t){this.mode="list",this.selected=e,this.active=e,this.focus=e,this._element=t[0],this._isFocusEvent=!1}return t.$inject=["$element"],angular.extend(t.prototype,{select:function(e){this.active=e,"multiselect"===this.mode?this.isSelected(e)===!1&&this.selected.push(e):this.selected=e},deselect:function(t){if(this.active=t,"multiselect"===this.mode){var o=this.selected.indexOf(t);-1!==o&&this.selected.splice(o,1)}else t===this.selected&&(this.selected=e)},toggle:function(e){this.isSelected(e)?this.deselect(e):this.select(e)},isSelected:function(e){return"multiselect"===this.mode?-1!==this.selected.indexOf(e):this.selected===e},previous:function(){var e=this._locate(this.active).previous;return e?(this.active=e.model,!0):!1},next:function(){var e=this._locate(this.active).next;return e?(this.active=e.model,!0):!1},_locate:function(e){for(var t=this._element.querySelectorAll("[kb-item]"),o=0;o<t.length;o++){var n=angular.element(t.item(o)),l=n.controller("kbItem");if(l.getModel()===e){var i={model:e,controller:l,element:n};if(0!==o){var r={element:angular.element(t.item(o-1))};r.controller=r.element.controller("kbItem"),r.model=r.controller.getModel(),i.previous=r}if(o<t.length-1){var c={element:angular.element(t.item(o+1))};c.controller=c.element.controller("kbItem"),c.model=c.controller.getModel(),i.next=c}return i}}return{}},first:function(){var e={},t=this._element.querySelector("[kb-item]");return t&&(e.element=angular.element(t),e.controller=e.element.controller("kbItem"),e.model=e.controller.getModel()),e}}),t}]),angular.module("keyboard").factory("kbScrollTo",["$window",function(e){function t(e,t,o,i){if(i&&angular.element.prototype.animate){var r=angular.element(e),c={};return c[t]=o,r.animate(c,l),function(){r.stop(!0,!0)}}return e[t]=o,n}function o(l,r,c){for(var a=n,s=l.parentElement;s.nodeName!==i;){var u=getComputedStyle(s),d=u.overflow+u.overflowX+u.overflowY;if(d.match(/scroll|hidden/))break;s=s.parentElement}var f=l.getBoundingClientRect(),m={top:Math.ceil(f.top),right:Math.ceil(f.right),bottom:Math.ceil(f.bottom),left:Math.ceil(f.left)};if(s.nodeName===i)var h={top:0,right:e.innerWidth,bottom:e.innerHeight,left:0};else var v=s.getBoundingClientRect(),h={top:Math.ceil(v.top),right:Math.ceil(v.right),bottom:Math.ceil(v.bottom),left:Math.ceil(v.left)};var g=m.top-h.top,p=h.right-m.right,b=h.bottom-m.bottom,k=m.left-h.left;if(g+r.top<0?(a=t(s,"scrollTop",s.scrollTop+g+r.top,c),b+=g,g=0):b+r.bottom<0&&(a=t(s,"scrollTop",s.scrollTop-b+r.bottom,c),g+=b,b=0),k+r.left<0?(a=t(s,"scrollLeft",s.scrollLeft+k+r.left,c),p+=k,k=0):p+r.right<0&&(a=t(s,"scrollLeft",s.scrollLeft-p+r.right,c),k+=p,p=0),s.nodeName===i)return a;var w=o(s,{top:g,right:g,bottom:b,left:k},c);return function(){a(),w()}}var n=angular.noop,l=150,i="BODY";return navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(i="HTML"),o}]),angular.module("keyboard").constant("undefined"),angular.module("keyboard").directive("kbItem",["$animate","$parse","kbScrollTo","$timeout",function(e,t,o,n){"use strict";function l(e,t){n.cancel(i),t?i=n(function(){r(),r=o(e[0],{top:0,right:0,bottom:0,left:0},!1)},100,!1):(r(),r=o(e[0],{top:0,right:0,bottom:0,left:0},!0))}var i=null,r=angular.noop;return{controller:["$scope","$element",function(e,o){this.getModel=function(){var n=t(o.attr("kb-item"));return function(){return n(e)}}()}],require:["^kbList","kbItem"],link:function(t,o,n,i){var r=i[0],c=i[1];o.on("click",function(){"list"===r.mode?r.select(c.getModel()):r.toggle(c.getModel()),t.$apply()});var a=n.kbSelectedClass||"kb-selected";t.$watch(function(){return r.isSelected(c.getModel())},function(t){t?e.addClass(o,a):e.removeClass(o,a)});var s=n.kbActiveClass||"kb-active";t.$watch(function(){return r.active===c.getModel()},function(t){t?e.addClass(o,s):e.removeClass(o,s)});var u=n.kbFocusClass||"kb-focus";t.$watch(function(){return r.focus===c.getModel()},function(t){t?(e.addClass(o,u),l(o,r._isFocusEvent)):e.removeClass(o,u)})}}}]),angular.module("keyboard").directive("kbList",["KbListController",function(e){"use strict";return{controller:e,require:["kbList","ngModel"],link:function(e,t,o,n){function l(e,t,o){return"left"===e&&o.left<t.left?!0:"up"===e&&o.top<t.top?!0:"right"===e&&o.left>t.left?!0:"down"===e&&o.top>t.top?!0:!1}var i=n[0],r=n[1],c=!1;i.mode=o.kbList,r.$render=function(){if("multiselect"===i.mode){var e=r.$viewValue;angular.isArray(e)===!1&&(e=[]),i.selected=e;for(var t in e){i.active=e[t];break}}else i.selected=i.active=r.$viewValue},angular.isUndefined(t.attr("tabindex"))&&t.attr("tabindex",0),t.on("click",function(){document.activeElement!==this&&t.focus()}),t.on("focus",function(){i._isFocusEvent=!0,angular.isUndefined(i.active)&&(i.active=i.first().model),i.focus=i.active,c=!0,e.$apply(),i._isFocusEvent=!1}),t.on("blur",function(){i.focus=null,c=!1,e.$apply()});var a={37:"left",38:"up",39:"right",40:"down"};t.on("keydown",function(t){if(!angular.isUndefined(i.active)){var o=!1;if(t.which>=37&&t.which<=40){var n=i._locate(i.active),r=n.element[0].getBoundingClientRect();n.previous&&l(a[t.which],r,n.previous.element[0].getBoundingClientRect())&&(i.active=n.previous.model,o=!0),n.next&&l(a[t.which],r,n.next.element[0].getBoundingClientRect())&&(i.active=n.next.model,o=!0)}else"list"===i.mode||32!==t.which&&13!==t.which||(i.toggle(i.active),o=!0);o&&(t.preventDefault(),e.$apply())}}),e.$watch(function(){return i.selected},function(e){r.$setViewValue(e)}),e.$watch(function(){return i.active},function(e){"list"===i.mode&&(i.selected=e),c&&(i.focus=e)})}}}]);
//# sourceMappingURL=keyboard.min.js.map